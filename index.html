<!DOCTYPE html>
<meta charset="utf-8">

<style>

  html {
    overflow-y: scroll;
    overflow-x: scroll;
  }
  .graphPosition{
   }
  .graphSVG{
    position: fixed;
   
    transform: translate(100px,150px);
  
  }


  .legendInfo{
    font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
    position: relative;
    top: 650px;
    left: 20px;
  }
  .infoDiv{
    transform: translate(-380px,500px); 
    float: right;
    font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
    font-size: 20px;
    margin-top: 10px;
  }
  .map{
    transform: translate(0px,-100px);
    background-color: rgb(16, 116, 203);
  }
  
body{
  background-image: radial-gradient(white,ghostwhite,aliceblue);
}
h1{
  text-align: center;
}
.svgProstor{
  transform: translate(800px,-730px);
}
</style>
  <h1>Broj izbjeglica u Europi od 2005. do 2020. godine</h1>
<body>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://d3js.org/topojson.v0.min.js"></script>
<div>
  <svg class="legendsvg" id="legendsvg" height=100 width=750></svg>
</div>
<script>
var width = 760;
var height = 630;
var margin = { top: 50, bottom: 70, left: 80, right: 20 };
    var width1 = 560;
    var height1 = 500;

    var projection = d3.geo.mercator()
    .center([35, 60]) //long and lat starting position
    .scale(550) //starting zoom position
    .rotate([10,0]); //where world split occurs

var svg = d3.select("body").append("svg").attr("width",width).attr("height",height).attr("class","map")
d3.select("body").append("div").attr("id", "info").attr("class","infoDiv")

var path = d3.geo.path()
    .projection(projection);

var g = svg.append("g"); 
 
d3.json("eu.topojson.json", function(error, topology) { /// https://geojson-maps.ash.ms/, merlin materijali
var world = g.selectAll("path")
				.data(topojson.object(topology, topology.objects.europe).geometries)
				.enter()
				.append("path")
				.attr("d", path)
        .attr('fill', function(d){
            if(d.properties.izbjeglice_2020 < 100){
              return '#F2D7D5'
            }if(d.properties.izbjeglice_2020 > 100 && d.properties.izbjeglice_2020 < 1000 ){
              return '#E6B0AA'
            }if(d.properties.izbjeglice_2020 > 1000 && d.properties.izbjeglice_2020 < 2500 ){
              return '#D98880'
            }if(d.properties.izbjeglice_2020 > 2500 && d.properties.izbjeglice_2020 < 5000 ){
              return '#CD6155'
            }if(d.properties.izbjeglice_2020 > 5000 && d.properties.izbjeglice_2020 < 15000 ){
              return '#C0392B'
            }if(d.properties.izbjeglice_2020 > 15000 && d.properties.izbjeglice_2020 < 50000 ){
              return '#A93226'
            }
            if(d.properties.izbjeglice_2020 > 50000 && d.properties.izbjeglice_2020 < 200000 ){
              return '#922B21'
            }if(d.properties.izbjeglice_2020 > 200000 && d.properties.izbjeglice_2020 < 1000000 ){
              return '#7B241C'
            }
            if(d.properties.izbjeglice_2020 > 1000000){
              return '#641E16'
            }
        })
              .on("click",d=> {
                            const data = {
                                ime: d.properties.name,
                                broj2020 : d.properties.izbjeglice_2020,
                                broj2015 : d.properties.izbjeglice_2015,
                                broj2010 : d.properties.izbjeglice_2010,
                                broj2005 : d.properties.izbjeglice_2005,
                            }
        console.log(topojson.object(topology,topology.objects.europe))
 createGraph(data)})

});
var graphSvg = d3.select("body")
      .append("svg")
      .attr("width", width1 + margin.left + margin.right)
      .attr("height", height1 + margin.bottom + margin.top)
      .attr("class","svgProstor")
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .attr("class","graphSVG"); 

/* const graphSvg = d3.select("body").append("svg")
            .attr("width", 800)
            .attr("height", 630)
            .attr("class","graphSVG"); */
        let svgBar = graphSvg.append('g').attr("class","graphPosition");
        let graphMade = false;


function createGraph(jsonData){  ////https://d3-graph-gallery.com/graph/line_basic.html
  if(graphMade){
    svgBar.remove()
    svgBar = graphSvg.append('g');
  }
  console.log(graphMade)

  var data = [
        { Godina: "2005.", izbjeglice: jsonData.broj2005},
        { Godina: "2010.", izbjeglice: jsonData.broj2010},
        { Godina: "2015.", izbjeglice: jsonData.broj2015},
        { Godina: "2020.", izbjeglice: jsonData.broj2020},
      ];

    var margin = {top: 50, bottom: 70, left: 40, right: 20};
    var width = 590 - margin.left - margin.right;
    var height = 510 - margin.top - margin.bottom;
    var barPadding = 4;
    var barWidth = width / data.length - barPadding;

var x = d3.scale.ordinal()
  .domain(d3.range(data.length))
  .rangeRoundBands([0, width]);
var y = d3.scale.linear()
  .domain([0, d3.max(data, function(d) { return d.izbjeglice; })])
  .range([height, 0]);

var xAxis = d3.svg.axis()
  .scale(x)
  .orient("bottom")
  .tickFormat(function(d, i) { return data[i].Godina; });
var yAxis = d3.svg.axis()
  .scale(y)
  .orient("left")
  .ticks(12);

svgBar.append("g")
  .attr("class", "x axis")
  .attr("transform", "translate(0," + height + ")")
  .call(xAxis)
  .selectAll("text")
  .style("text-anchor", "middle");

svgBar.append("text")
  .attr("x", (width / 2))
  .attr("y", -(margin.top / 2))
  .attr("font-weight", "bold")
  .style("font-size", "20px")
  .style("text-anchor", "middle")
  .text("Broj izbjeglica u Europi od 2005. do 2020. godine");

svgBar.append("g")
  .attr("class", "y axis")
  .call(yAxis)
  .append("text")
  .attr("transform", "rotate(-90)")
  .attr("x", -(height / 2))
  .attr("y", -((margin.left / 2) + 50))
  .style("text-anchor", "middle")
  .style("font-size", "18px")
  .text("Broj izbjeglica")

svgBar.append("text")
  .attr("x", (width / 2))
  .attr("y", (height + (margin.bottom / 2)))
  .attr("dy", "1em")
  .style("text-anchor", "middle")
  
  .style("font-size", "18px")
  .text("Godina");

var barchart = svgBar.selectAll("rect")
  .data(data)
  .enter()
  .append("rect")
  .attr("x", function(d, i) { return x(i); })
  .attr("y", function(d, i) { return y(d.izbjeglice); })
  .attr("height", function(d) { return height - y(d.izbjeglice); })
  .attr("width", barWidth)
  .attr("fill", "#641E16");
                
        graphMade = true;
        console.log(graphMade)
        d3.select(
              "#info"
            ).html(`Država: ${jsonData.ime}<br> Broj izbjeglica 2005. godine: ${jsonData.broj2005} <br> Broj izbjeglica 2010. godine: ${jsonData.broj2010} <br> Broj izbjeglica 2015. godine: ${jsonData.broj2015} <br> Broj izbjeglica 2020. godine: ${jsonData.broj2020}   `);
            d3.select()
}

  var svg_legend = d3.select("#legendsvg").attr("class","legendInfo")
svg_legend.append("circle").attr("cx",10).attr("cy",15).attr("r", 6).style("fill", "#F2D7D5")
svg_legend.append("circle").attr("cx",10).attr("cy",40).attr("r", 6).style("fill", "#E6B0AA")
svg_legend.append("circle").attr("cx",10).attr("cy",65).attr("r", 6).style("fill", "#D98880")
svg_legend.append("text").attr("x", 25).attr("y", 15).text("Broj izbjeglica od 0-100").style("font-size", "15px").attr("alignment-baseline","middle")
svg_legend.append("text").attr("x", 25).attr("y", 40).text("Broj izbjeglica od 100-1000").style("font-size", "15px").attr("alignment-baseline","middle")
svg_legend.append("text").attr("x", 25).attr("y", 65).text("Broj izbjeglica od 1000-2500").style("font-size", "15px").attr("alignment-baseline","middle")

svg_legend.append("circle").attr("cx",230).attr("cy",15).attr("r", 6).style("fill", "#CD6155")
svg_legend.append("circle").attr("cx",230).attr("cy",40).attr("r", 6).style("fill", "#C0392B")
svg_legend.append("circle").attr("cx",230).attr("cy",65).attr("r", 6).style("fill", "#A93226")

svg_legend.append("text").attr("x", 245).attr("y", 15).text("Broj izbjeglica od 2500-5000").style("font-size", "15px").attr("alignment-baseline","middle")
svg_legend.append("text").attr("x", 245).attr("y", 40).text("Broj izbjeglica od 5000-15000").style("font-size", "15px").attr("alignment-baseline","middle")
svg_legend.append("text").attr("x", 245).attr("y", 65).text("Broj izbjeglica od 15000-50000").style("font-size", "15px").attr("alignment-baseline","middle")

svg_legend.append("circle").attr("cx",465).attr("cy",15).attr("r", 6).style("fill", "#922B21")
svg_legend.append("circle").attr("cx",465).attr("cy",40).attr("r", 6).style("fill", "#7B241C")
svg_legend.append("circle").attr("cx",465).attr("cy",65).attr("r", 6).style("fill", "#641E16")
svg_legend.append("text").attr("x", 480).attr("y", 15).text("Broj izbjeglica od 50000-200000").style("font-size", "15px").attr("alignment-baseline","middle")
svg_legend.append("text").attr("x", 480).attr("y", 40).text("Broj izbjeglica od 200000-1000000").style("font-size", "15px").attr("alignment-baseline","middle")
svg_legend.append("text").attr("x", 480).attr("y", 65).text("Broj izbjeglica više od 1000000").style("font-size", "15px").attr("alignment-baseline","middle") 
</script>
</body>
</html>